# ฟีเจอร์แก้ไขสัญญา (Contract Edit Feature)

## ภาพรวม
ฟีเจอร์แก้ไขสัญญาช่วยให้ผู้ใช้สามารถแก้ไขข้อมูลสัญญาที่มีอยู่แล้วได้ โดยไม่ต้องสร้างสัญญาใหม่

## ไฟล์ที่เกี่ยวข้อง

### Frontend Components
1. **`src/components/forms/ContractEditForm.jsx`** - ฟอร์มแก้ไขสัญญา
2. **`src/components/ContractDetailModal.jsx`** - Modal แสดงรายละเอียดสัญญา
3. **`src/components/tables/ContractsTable.jsx`** - ตารางแสดงรายการสัญญา (เพิ่มปุ่มแก้ไข)
4. **`src/components/pages/ContractsPage.jsx`** - หน้าหลักจัดการสัญญา

### Services
1. **`src/services/installmentsService.js`** - Service สำหรับจัดการข้อมูลสัญญา

## การใช้งาน

### 1. การเข้าถึงฟีเจอร์แก้ไข
- ไปที่หน้า "รายการสัญญา"
- คลิกปุ่ม "แก้ไข" ในคอลัมน์ "การดำเนินการ" ของสัญญาที่ต้องการแก้ไข

### 2. ฟอร์มแก้ไขสัญญา
ฟอร์มแก้ไขประกอบด้วยส่วนต่างๆ ดังนี้:

#### ข้อมูลลูกค้า
- เลือกลูกค้าจากรายการที่มีอยู่
- แก้ไขข้อมูลส่วนตัว: ชื่อ, ที่อยู่, เบอร์โทรศัพท์
- ข้อมูลผู้ค้ำประกัน (ถ้ามี)

#### ข้อมูลสินค้า
- เลือกสินค้าจากรายการที่มีอยู่
- แก้ไขรายละเอียดสินค้า: รุ่น, S/N, ราคา

#### แผนการผ่อนชำระ
- แก้ไขเงินดาวน์
- แก้ไขจำนวนเงินผ่อนต่อเดือน
- แก้ไขจำนวนงวด
- แก้ไขวันที่เก็บเงิน

#### ข้อมูลพนักงาน
- เลือกพนักงานขาย
- เลือกผู้ตรวจสอบ
- เลือกสายงาน

### 3. การบันทึกการแก้ไข
- คลิกปุ่ม "บันทึกการแก้ไข" เพื่อบันทึกการเปลี่ยนแปลง
- ระบบจะแสดงข้อความยืนยันเมื่อบันทึกสำเร็จ
- ข้อมูลในตารางจะอัปเดตโดยอัตโนมัติ

### 4. การดูรายละเอียดสัญญา
- คลิกปุ่ม "ดู" เพื่อดูรายละเอียดสัญญาในรูปแบบ Modal
- Modal จะแสดงข้อมูลครบถ้วนของสัญญา
- สามารถคลิกปุ่ม "แก้ไข" จาก Modal เพื่อเข้าสู่ฟอร์มแก้ไข

## ฟีเจอร์พิเศษ

### 1. การค้นหาข้อมูล
- ฟอร์มแก้ไขมีฟีเจอร์ค้นหาสำหรับลูกค้า, สินค้า, และพนักงาน
- พิมพ์ชื่อหรือรหัสเพื่อค้นหาข้อมูลที่ต้องการ

### 2. การตรวจสอบข้อมูล
- ระบบจะตรวจสอบข้อมูลที่จำเป็นก่อนบันทึก
- แสดงข้อความแจ้งเตือนหากข้อมูลไม่ครบถ้วน

### 3. การจัดการวันที่
- รองรับการแปลงวันที่ไทย (พ.ศ.) เป็นคริสต์ศักราช (ค.ศ.)
- แสดงวันที่ในรูปแบบที่อ่านง่าย

## การเชื่อมต่อกับ Backend

### API Endpoints ที่ใช้
- `GET /api/installments/:id` - ดึงข้อมูลสัญญา
- `PUT /api/installments/:id` - อัปเดตข้อมูลสัญญา
- `GET /api/customers` - ดึงรายการลูกค้า
- `GET /api/products` - ดึงรายการสินค้า
- `GET /api/employees` - ดึงรายการพนักงาน
- `GET /api/checkers` - ดึงรายการผู้ตรวจสอบ

### การจัดการข้อมูล
- ข้อมูลจะถูกแปลงจากโครงสร้าง nested objects เป็น flat fields สำหรับ database
- รองรับการแปลงวันที่และรูปแบบข้อมูลต่างๆ

## การแก้ไขปัญหา

### ปัญหาที่พบบ่อย
1. **ข้อมูลไม่โหลด** - ตรวจสอบการเชื่อมต่อ API และ branchId
2. **ไม่สามารถบันทึกได้** - ตรวจสอบข้อมูลที่จำเป็นและรูปแบบข้อมูล
3. **วันที่แสดงผิด** - ตรวจสอบการแปลงวันที่และ timezone

### การ Debug
- เปิด Developer Tools เพื่อดู Console logs
- ตรวจสอบ Network tab เพื่อดู API calls
- ตรวจสอบ Response จาก API

## การพัฒนาต่อ

### ฟีเจอร์ที่อาจเพิ่มในอนาคต
1. การเปรียบเทียบข้อมูลก่อนและหลังแก้ไข
2. การบันทึกประวัติการแก้ไข
3. การส่งการแจ้งเตือนเมื่อมีการแก้ไข
4. การอนุมัติการแก้ไขจากผู้ดูแลระบบ

## หมายเหตุ
- ฟีเจอร์นี้ต้องการการเชื่อมต่อกับ backend ที่รองรับ API endpoints ที่ระบุ
- ข้อมูลจะถูกบันทึกในรูปแบบที่เข้ากันได้กับ database schema ที่มีอยู่
- การแก้ไขจะส่งผลต่อข้อมูลในตาราง `installments` โดยตรง 